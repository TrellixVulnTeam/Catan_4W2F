{"ast":null,"code":"import _slicedToArray from \"/home/agustina/Descargas/catan/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/agustina/Descargas/catan/src/components/BankTrade.jsx\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { Link, useParams, useHistory } from \"react-router-dom\";\nimport \"../css/banktrade.css\";\nimport GameContext, { DEFAULT } from \"../GameContext\";\nimport CatanTypes, { RESOURCES } from \"../CatanTypes\";\nimport api from \"../Api\";\nimport { ReactComponent as BrickIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../public/icons/brick.svg\";\nimport { ReactComponent as WoolIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../public/icons/sheep.svg\";\nimport { ReactComponent as OreIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../public/icons/stone.svg\";\nimport { ReactComponent as LumberIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../public/icons/trees.svg\";\nimport { ReactComponent as GrainIcon } from \"@svgr/webpack?-svgo,+titleProp,+ref!../public/icons/wheat.svg\";\nexport default function BankTrade() {\n  const _useState = useState({\n    resources: null\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        resources = _useState2[0].resources,\n        setResources = _useState2[1];\n\n  const _useState3 = useState({\n    offer: null,\n    request: null\n  }),\n        _useState4 = _slicedToArray(_useState3, 2),\n        _useState4$ = _useState4[0],\n        offer = _useState4$.offer,\n        request = _useState4$.request,\n        setTradeState = _useState4[1]; // TODO: gameId can't come frome GameContext since BankTrade is another view\n  // that is not inside <Game />\n\n\n  const _useParams = useParams(),\n        gameId = _useParams.gameId;\n\n  const history = useHistory(); // Resources the player can offer for a bank trade (i.e. has more than 4)\n\n  const canOffer = _.keys(_.pickBy(_.countBy(resources), a => a >= 4));\n\n  useEffect(() => {\n    const fetchResources = async () => {\n      const player = await api.games.player(gameId);\n      setResources({\n        resources: player.data.resources\n      });\n    };\n\n    fetchResources();\n    const interval = setInterval(() => fetchResources(), api.POLL_EVERY);\n    return () => clearInterval(interval);\n  }, [gameId]);\n\n  function trade() {\n    // callback that is called from the container, it uses its current scope\n    // for knowing offer and request variables\n    api.games.playAction(gameId, \"bank_trade\", {\n      give: offer,\n      receive: request\n    });\n    history.push(\"/game/\".concat(gameId));\n  }\n\n  if (!resources) return React.createElement(\"i\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52\n    },\n    __self: this\n  }, \"Determining Trade Options...\");\n  return React.createElement(BankTradeContainer, {\n    offer: offer,\n    request: request,\n    canOffer: canOffer,\n    gameId: gameId,\n    setTradeState: setTradeState,\n    trade: trade,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54\n    },\n    __self: this\n  });\n} // TODO: We are missusing the term container.\n// In redux jargon component is used to refer to presentational components\n// and container for logic components that contains those components\n// we are using the term container as the exact opposite of what it is\n// and we are not even using redux :)\n\nfunction BankTradeContainer({\n  offer = null,\n  request = null,\n  canOffer,\n  gameId,\n  setTradeState,\n  trade\n}) {\n  const setOffer = resource => setTradeState({\n    offer: resource,\n    request\n  });\n\n  const setRequest = resource => setTradeState({\n    offer,\n    request: resource\n  });\n\n  const resourcesData = {\n    brick: {\n      icon: React.createElement(BrickIcon, {\n        className: \"w-16 h-8 p-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }),\n      styleClasses: \"bg-red-800 text-orange-500 border-2\",\n      hoverClasses: \"hover:bg-red-700 hover:border-orange-500\",\n      focusClasses: \"bg-red-700 border-orange-500\"\n    },\n    lumber: {\n      icon: React.createElement(LumberIcon, {\n        className: \"w-16 h-8 p-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }),\n      styleClasses: \"bg-green-900 text-green-500 border-2\",\n      hoverClasses: \"hover:bg-green-800 hover:border-green-500\",\n      focusClasses: \"bg-green-800 border-green-500\"\n    },\n    grain: {\n      icon: React.createElement(GrainIcon, {\n        className: \"w-16 h-8 p-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }),\n      styleClasses: \"bg-yellow-500 text-yellow-900 border-2\",\n      hoverClasses: \"hover:bg-yellow-400 hover:border-yellow-900\",\n      focusClasses: \"bg-yellow-400 border-yellow-900\"\n    },\n    ore: {\n      icon: React.createElement(OreIcon, {\n        className: \"w-16 h-8 p-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }),\n      styleClasses: \"bg-gray-700 text-gray-500 border-2\",\n      hoverClasses: \"hover:bg-gray-600 hover:border-gray-500\",\n      focusClasses: \"bg-gray-600 border-gray-900\"\n    },\n    wool: {\n      icon: React.createElement(WoolIcon, {\n        className: \"w-16 h-8 p-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }),\n      styleClasses: \"bg-green-500 text-green-900 border-2\",\n      hoverClasses: \"hover:bg-green-400 hover:border-green-900\",\n      focusClasses: \"bg-green-400 border-green-900\"\n    }\n  };\n\n  const commonBtnClasses = resource => {\n    return \"mx-3 py-2 rounded-lg \".concat(resourcesData[resource].styleClasses, \" disabled:cursor-not-allowed\");\n  };\n\n  return React.createElement(\"div\", {\n    className: \"flex flex-col justify-center items-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"flex flex-col bg-gray-200 w-1/2 text-center rounded-lg text-gray-900 p-4 mt-40\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(\"h1\", {\n    className: \"text-4xl font-cinzel w-full pb-6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, \"Bank Trading\"), React.createElement(\"div\", {\n    className: \"flex flex-col pb-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"text-bold text-lg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, \"Give 4\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, RESOURCES.map(resource => React.createElement(\"button\", {\n    key: resource,\n    className: \"text-center \".concat(commonBtnClasses(resource), \" \").concat(canOffer.includes(resource) ? resourcesData[resource].hoverClasses : \"opacity-50\", \" \").concat(offer === resource ? resourcesData[resource].focusClasses : \"\"),\n    type: \"button\",\n    onClick: () => setOffer(resource),\n    disabled: !canOffer.includes(resource),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, resourcesData[resource].icon)))), React.createElement(\"div\", {\n    className: \"flex flex-col pb-6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    className: \"text-bold text-lg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \"Recive 1\"), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, RESOURCES.map(resource => React.createElement(\"button\", {\n    key: resource,\n    className: \"\".concat(commonBtnClasses(resource), \"\\n                \").concat(resourcesData[resource].hoverClasses, \" \").concat(request === resource ? resourcesData[resource].focusClasses : \"\"),\n    type: \"button\",\n    onClick: () => setRequest(resource),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, resourcesData[resource].icon)))), React.createElement(\"div\", {\n    className: \"flex self-center justify-around w-1/2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/game/\".concat(gameId),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    className: \"px-4 bg-transparent p-3 rounded-lg text-blue-800 bg-gray-300 hover:bg-gray-400 mr-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, \"Cancel\")), React.createElement(\"button\", {\n    type: \"button\",\n    onClick: trade,\n    disabled: offer === null || request === null,\n    className: \"px-4 bg-transparent p-3 rounded-lg bg-blue-800 text-gray-100 hover:bg-blue-900 hover:text-blue-200 mr-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }, \"Trade\"))));\n}\n\nBankTradeContainer.propTypes = {\n  offer: CatanTypes.Resource,\n  request: CatanTypes.Resource,\n  canOffer: PropTypes.arrayOf(CatanTypes.Resource).isRequired,\n  gameId: PropTypes.string.isRequired,\n  setTradeState: PropTypes.func.isRequired,\n  trade: PropTypes.func.isRequired\n}; // TODO: Eventually defaultProps will be deprecated, but for now eslint\n// has not been updated to use es6 default parameters instead\n// https://github.com/yannickcr/eslint-plugin-react/issues/666\n// when it happens, move this and other occurrences as default parameters\n\nBankTradeContainer.defaultProps = {\n  offer: null,\n  request: null\n};\nexport function BankTradeButton() {\n  const _useContext = useContext(GameContext),\n        phase = _useContext.phase,\n        gameId = _useContext.gameId;\n\n  const validPhase = [DEFAULT].includes(phase);\n\n  const _useState5 = useState(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        canTrade = _useState6[0],\n        setCanTrade = _useState6[1];\n\n  const enabled = canTrade && validPhase;\n  useEffect(() => {\n    const fetchActions = async () => {\n      const _ref = await api.games.actions(gameId),\n            actions = _ref.data;\n\n      const bankTradeAvailable = actions.some(a => a.type === \"bank_trade\");\n      setCanTrade(bankTradeAvailable);\n    };\n\n    fetchActions();\n    const interval = setInterval(() => fetchActions(), api.POLL_EVERY);\n    return () => clearInterval(interval);\n  }, [gameId]);\n  const TextClasses = \"\\n    text-center\\n    text-xl\\n    self-center\\n    tracking-wider\\n    text-bold\\n    text-white\\n    font-cinzel\\n  \";\n  const CommonClasses = \"w-5/6 shadow-md rounded h-12\";\n  return React.createElement(Link, {\n    to: \"/game/\".concat(gameId, \"/bankTrade\"),\n    className: \"w-full text-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    type: \"button\",\n    disabled: !enabled,\n    className: \"\\n          h-16\\n          bg-blue-800\\n          w-full\\n          hover:bg-blue-900\\n          disabled:cursor-not-allowed\\n          disabled:opacity-50\\n          \".concat(CommonClasses, \"\\n          \").concat(TextClasses, \"\\n        \"),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235\n    },\n    __self: this\n  }, \"Trade with bank\"));\n}","map":{"version":3,"sources":["/home/agustina/Descargas/catan/src/components/BankTrade.jsx"],"names":["React","useState","useEffect","useContext","_","PropTypes","Link","useParams","useHistory","GameContext","DEFAULT","CatanTypes","RESOURCES","api","BankTrade","resources","setResources","offer","request","setTradeState","gameId","history","canOffer","keys","pickBy","countBy","a","fetchResources","player","games","data","interval","setInterval","POLL_EVERY","clearInterval","trade","playAction","give","receive","push","BankTradeContainer","setOffer","resource","setRequest","resourcesData","brick","icon","styleClasses","hoverClasses","focusClasses","lumber","grain","ore","wool","commonBtnClasses","map","includes","propTypes","Resource","arrayOf","isRequired","string","func","defaultProps","BankTradeButton","phase","validPhase","canTrade","setCanTrade","enabled","fetchActions","actions","bankTradeAvailable","some","type","TextClasses","CommonClasses"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\n\nimport _ from \"lodash\";\nimport PropTypes from \"prop-types\";\nimport { Link, useParams, useHistory } from \"react-router-dom\";\n\nimport \"../css/banktrade.css\";\nimport GameContext, { DEFAULT } from \"../GameContext\";\nimport CatanTypes, { RESOURCES } from \"../CatanTypes\";\nimport api from \"../Api\";\nimport { ReactComponent as BrickIcon } from \"../public/icons/brick.svg\";\nimport { ReactComponent as WoolIcon } from \"../public/icons/sheep.svg\";\nimport { ReactComponent as OreIcon } from \"../public/icons/stone.svg\";\nimport { ReactComponent as LumberIcon } from \"../public/icons/trees.svg\";\nimport { ReactComponent as GrainIcon } from \"../public/icons/wheat.svg\";\n\nexport default function BankTrade() {\n  const [{ resources }, setResources] = useState({ resources: null });\n  const [{ offer, request }, setTradeState] = useState({\n    offer: null,\n    request: null\n  });\n\n  // TODO: gameId can't come frome GameContext since BankTrade is another view\n  // that is not inside <Game />\n  const { gameId } = useParams();\n  const history = useHistory();\n\n  // Resources the player can offer for a bank trade (i.e. has more than 4)\n  const canOffer = _.keys(_.pickBy(_.countBy(resources), a => a >= 4));\n\n  useEffect(() => {\n    const fetchResources = async () => {\n      const player = await api.games.player(gameId);\n      setResources({ resources: player.data.resources });\n    };\n    fetchResources();\n    const interval = setInterval(() => fetchResources(), api.POLL_EVERY);\n    return () => clearInterval(interval);\n  }, [gameId]);\n\n  function trade() {\n    // callback that is called from the container, it uses its current scope\n    // for knowing offer and request variables\n    api.games.playAction(gameId, \"bank_trade\", {\n      give: offer,\n      receive: request\n    });\n    history.push(`/game/${gameId}`);\n  }\n\n  if (!resources) return <i>Determining Trade Options...</i>;\n  return (\n    <BankTradeContainer\n      offer={offer}\n      request={request}\n      canOffer={canOffer}\n      gameId={gameId}\n      setTradeState={setTradeState}\n      trade={trade}\n    />\n  );\n}\n\n// TODO: We are missusing the term container.\n// In redux jargon component is used to refer to presentational components\n// and container for logic components that contains those components\n// we are using the term container as the exact opposite of what it is\n// and we are not even using redux :)\nfunction BankTradeContainer({\n  offer = null,\n  request = null,\n  canOffer,\n  gameId,\n  setTradeState,\n  trade\n}) {\n  const setOffer = resource => setTradeState({ offer: resource, request });\n  const setRequest = resource => setTradeState({ offer, request: resource });\n\n  const resourcesData = {\n    brick: {\n      icon: <BrickIcon className=\"w-16 h-8 p-1\" />,\n      styleClasses: \"bg-red-800 text-orange-500 border-2\",\n      hoverClasses: \"hover:bg-red-700 hover:border-orange-500\",\n      focusClasses: \"bg-red-700 border-orange-500\"\n    },\n    lumber: {\n      icon: <LumberIcon className=\"w-16 h-8 p-1\" />,\n      styleClasses: \"bg-green-900 text-green-500 border-2\",\n      hoverClasses: \"hover:bg-green-800 hover:border-green-500\",\n      focusClasses: \"bg-green-800 border-green-500\"\n    },\n    grain: {\n      icon: <GrainIcon className=\"w-16 h-8 p-1\" />,\n      styleClasses: \"bg-yellow-500 text-yellow-900 border-2\",\n      hoverClasses: \"hover:bg-yellow-400 hover:border-yellow-900\",\n      focusClasses: \"bg-yellow-400 border-yellow-900\"\n    },\n    ore: {\n      icon: <OreIcon className=\"w-16 h-8 p-1\" />,\n      styleClasses: \"bg-gray-700 text-gray-500 border-2\",\n      hoverClasses: \"hover:bg-gray-600 hover:border-gray-500\",\n      focusClasses: \"bg-gray-600 border-gray-900\"\n    },\n    wool: {\n      icon: <WoolIcon className=\"w-16 h-8 p-1\" />,\n      styleClasses: \"bg-green-500 text-green-900 border-2\",\n      hoverClasses: \"hover:bg-green-400 hover:border-green-900\",\n      focusClasses: \"bg-green-400 border-green-900\"\n    }\n  };\n\n  const commonBtnClasses = resource => {\n    return `mx-3 py-2 rounded-lg ${resourcesData[resource].styleClasses} disabled:cursor-not-allowed`;\n  };\n\n  return (\n    <div className=\"flex flex-col justify-center items-center\">\n      <div className=\"flex flex-col bg-gray-200 w-1/2 text-center rounded-lg text-gray-900 p-4 mt-40\">\n        <h1 className=\"text-4xl font-cinzel w-full pb-6\">Bank Trading</h1>\n        <div className=\"flex flex-col pb-3\">\n          <span className=\"text-bold text-lg\">Give 4</span>\n          <div>\n            {RESOURCES.map(resource => (\n              <button\n                key={resource}\n                className={`text-center ${commonBtnClasses(resource)} ${\n                  canOffer.includes(resource)\n                    ? resourcesData[resource].hoverClasses\n                    : \"opacity-50\"\n                } ${\n                  offer === resource ? resourcesData[resource].focusClasses : \"\"\n                }`}\n                type=\"button\"\n                onClick={() => setOffer(resource)}\n                disabled={!canOffer.includes(resource)}\n              >\n                {resourcesData[resource].icon}\n              </button>\n            ))}\n          </div>\n        </div>\n        <div className=\"flex flex-col pb-6\">\n          <span className=\"text-bold text-lg\">Recive 1</span>\n          <div>\n            {RESOURCES.map(resource => (\n              <button\n                key={resource}\n                className={`${commonBtnClasses(resource)}\n                ${resourcesData[resource].hoverClasses} ${\n                  request === resource\n                    ? resourcesData[resource].focusClasses\n                    : \"\"\n                }`}\n                type=\"button\"\n                onClick={() => setRequest(resource)}\n              >\n                {resourcesData[resource].icon}\n              </button>\n            ))}\n          </div>\n        </div>\n        <div className=\"flex self-center justify-around w-1/2\">\n          <Link to={`/game/${gameId}`}>\n            <button\n              type=\"button\"\n              className=\"px-4 bg-transparent p-3 rounded-lg text-blue-800 bg-gray-300 hover:bg-gray-400 mr-2\"\n            >\n              Cancel\n            </button>\n          </Link>\n          <button\n            type=\"button\"\n            onClick={trade}\n            disabled={offer === null || request === null}\n            className=\"px-4 bg-transparent p-3 rounded-lg bg-blue-800 text-gray-100 hover:bg-blue-900 hover:text-blue-200 mr-2\"\n          >\n            Trade\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nBankTradeContainer.propTypes = {\n  offer: CatanTypes.Resource,\n  request: CatanTypes.Resource,\n  canOffer: PropTypes.arrayOf(CatanTypes.Resource).isRequired,\n  gameId: PropTypes.string.isRequired,\n  setTradeState: PropTypes.func.isRequired,\n  trade: PropTypes.func.isRequired\n};\n\n// TODO: Eventually defaultProps will be deprecated, but for now eslint\n// has not been updated to use es6 default parameters instead\n// https://github.com/yannickcr/eslint-plugin-react/issues/666\n// when it happens, move this and other occurrences as default parameters\nBankTradeContainer.defaultProps = {\n  offer: null,\n  request: null\n};\n\nexport function BankTradeButton() {\n  const { phase, gameId } = useContext(GameContext);\n  const validPhase = [DEFAULT].includes(phase);\n  const [canTrade, setCanTrade] = useState(false);\n  const enabled = canTrade && validPhase;\n\n  useEffect(() => {\n    const fetchActions = async () => {\n      const { data: actions } = await api.games.actions(gameId);\n      const bankTradeAvailable = actions.some(a => a.type === \"bank_trade\");\n      setCanTrade(bankTradeAvailable);\n    };\n    fetchActions();\n    const interval = setInterval(() => fetchActions(), api.POLL_EVERY);\n    return () => clearInterval(interval);\n  }, [gameId]);\n\n  const TextClasses = `\n    text-center\n    text-xl\n    self-center\n    tracking-wider\n    text-bold\n    text-white\n    font-cinzel\n  `;\n  const CommonClasses = \"w-5/6 shadow-md rounded h-12\";\n\n  return (\n    <Link to={`/game/${gameId}/bankTrade`} className=\"w-full text-center\">\n      <button\n        type=\"button\"\n        disabled={!enabled}\n        className={`\n          h-16\n          bg-blue-800\n          w-full\n          hover:bg-blue-900\n          disabled:cursor-not-allowed\n          disabled:opacity-50\n          ${CommonClasses}\n          ${TextClasses}\n        `}\n      >\n        Trade with bank\n      </button>\n    </Link>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}